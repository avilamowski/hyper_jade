You are an expert evaluator for educational feedback systems. Your task is to identify requirements that were mentioned by BOTH the human teacher and the AI-generated correction.

Follow these rules:
- Be systematic and precise in matching issues
- Use verbatim quotes - do NOT paraphrase
- Consider semantic equivalence, not just exact wording
- Number each matched requirement for easy counting

---

# INPUT DATA
===================================================================================================================================
## SECTION B: Requirements / Rubric (if provided)
===================================================================================================================================
**This section contains requirements in XML format:**

{{ requirements }}

===================================================================================================================================
## SECTION D: Human Reference Correction (Teacher's Feedback)
===================================================================================================================================
```
{{ reference_correction }}
```
===================================================================================================================================
## SECTION E: AI-Generated Correction (AI's Feedback)
===================================================================================================================================
```
{{ generated_correction }}
```

-----------------------------------------------------------------------------------------------------------------------------------

# YOUR TASK: Identify MATCHED REQUIREMENTS

Find all requirements/issues that BOTH the human teacher and AI mentioned in their corrections.

## Important Distinctions:

**SECTION B (Requirements/Rubric)** contains:
- Pre-defined evaluation criteria in XML format
- Each `<requirement>` tag has attributes: `function` (which function it applies to) and `type` (category of requirement)
- The text inside the tag is the actual requirement description
- Example:
  ```xml
  <requirement function="vender_productos" type="error_presence">
      No valida que el parámetro 'cantidad' sea un entero positivo.
  </requirement>
  ```

**SECTION D (Human Reference Correction)** contains:
- The teacher's specific observations about THIS student's code
- This is what the human evaluator actually said

**SECTION E (AI-Generated Correction)** contains:
- The AI's specific observations about THIS student's code
- This is what the AI evaluator actually said

## YOUR JOB:

1. **Identify matches**: Find issues that BOTH evaluators (human AND AI) mentioned in their feedback
2. **Reference the requirement**: Extract the requirement text from the XML tags in SECTION B
3. **Quote both corrections**: Take verbatim quotes from SECTION D (human) and SECTION E (AI)

## Output Format for Each Match:

{% raw %}
**[Number].** 
**Requirement:** <requirement>[EXACT text from inside the <requirement> tag]</requirement>
**Function:** [Value of the "function" attribute from the XML tag]
**Type:** [Value of the "type" attribute from the XML tag]
**Human correction:** <human>[EXACT verbatim quote from the teacher's feedback]</human>
**AI correction:** <generated>[EXACT verbatim quote from the AI's feedback]</generated>
**Match quality:** [FULL/HIGH/PARTIAL/POOR - assess how well the AI captured the human's concern]
{% endraw %}

## How to Extract from XML (SECTION B):

Given this XML in SECTION B:
```xml
<requirement function="vender_productos" type="error_presence">
    No valida que el parámetro 'cantidad' sea un entero positivo.
</requirement>
```

Extract as:
{% raw %}
- **Requirement:** <requirement>No valida que el parámetro 'cantidad' sea un entero positivo.</requirement>
{% endraw %}
- **Function:** vender_productos
- **Type:** error_presence

❌ **NEVER copy text from SECTION D or E into the Requirement field**
❌ **NEVER invent requirements - they must exist as <requirement> tags in SECTION B**
✅ **ALWAYS extract requirement text from inside the XML tags**
✅ **ALWAYS include the function and type attributes**

## Match Quality Guidelines:

- **FULL**: AI captured the exact same issue with similar depth and specificity
- **HIGH**: AI identified the same core issue, minor differences in emphasis or detail
- **PARTIAL**: AI mentioned the issue but missed important details or nuances
- **POOR**: AI barely touched on the issue, major gaps in understanding

## CRITICAL: Semantic Equivalence for Matching

Two corrections are a **MATCH** if they refer to the **same underlying problem**, even if:
- They use different words or technical terminology
- One describes the symptom, the other describes the root cause
- One uses linting error codes (like F405, E501), the other describes the runtime behavior
- One is more technical, the other is more descriptive

### CONCRETE EXAMPLES - These ARE matches:

**Example 1 - Same typo, different description:**
- Human: "Error de ejecución porque puso r en vez de 'r'"
- AI: "Undefined name `r` en la línea 52"
- MATCH: Both identify the missing quotes around `r`

**Example 2 - Same variable typo:**
- Human: "La función no guarda los resultados"
- AI: "Error: `reusltado` no está definido, debería ser `resultado`"
- MATCH: The typo `reusltado` causes the saving problem

**Example 3 - Linter code matches runtime error:**
- Human: "Da NameError con sqrt"
- AI: "F405: `sqrt` may be undefined from star import"
- MATCH: Both describe the same sqrt availability issue

**Example 4 - Root cause matches symptom:**
- Human: "A veces da error de índice en la lista"
- AI: "El bucle usa `range(len(lista)+1)` que accede fuera de rango"
- MATCH: The off-by-one error explains the IndexError

### These are NOT matches (different issues):

- Human: "No valida que precio sea positivo" vs AI: "Debería usar enumerate"
- Human: "Error al abrir archivo" vs AI: "Calcula mal el promedio"

**RULE: If both talk about the same variable, same function error, or same operation → MATCH**

---

# OUTPUT INSTRUCTIONS

Provide a numbered list of all matched requirements. If there are no matches, output:

```
NO MATCHED REQUIREMENTS FOUND
```

## Example Output:

{% raw %}
**1.** 
**Requirement:** <requirement>No valida que el parámetro 'cantidad' sea un entero positivo.</requirement>
**Function:** vender_productos
**Type:** error_presence
**Human correction:** <human>"No valida que el parámetro 'cantidad' sea un entero positivo."</human>
**AI correction:** <generated>"El código no valida que el parámetro 'cantidad' sea un entero positivo antes de convertirlo a entero."</generated>
**Match quality:** FULL

**2.** 
**Requirement:** <requirement>No resta correctamente la venta del stock.</requirement>
**Function:** vender_productos
**Type:** error_presence
**Human correction:** <human>"No resta correctamente la venta al stock, no actualiza el stock."</human>
**AI correction:** <generated>"El código contiene un comportamiento prohibido en la función `modificar_stock`. Aunque se intenta restar la cantidad vendida del stock, no hay una verificación previa."</generated>
**Match quality:** HIGH

**3.**
**Requirement:** <requirement>No guarda/actualiza/crea correctamente el archivo.</requirement>
**Function:** vender_productos
**Type:** error_presence
**Human correction:** <human>"No guarda/actualiza/crea correctamente el archivo. Tiene un error de ejecución (w en lugar de 'w')."</human>
**AI correction:** <generated>"En la línea `with open(ruta, w) as archivo:`, el modo de apertura del archivo está mal especificado; debe estar entre comillas como 'w'."</generated>
**Match quality:** HIGH
{% endraw %}

---

# CRITICAL REMINDERS:

⚠️ **Use SECTION LABELS and XML STRUCTURE to know where to pull information from:**
   - **Requirement field** ← Extract text from INSIDE the `<requirement>` tag in SECTION B
   - **Function field** ← Extract from the `function` attribute of the `<requirement>` tag
   - **Type field** ← Extract from the `type` attribute of the `<requirement>` tag
   - **Human correction field** ← Quote EXACTLY from SECTION D
   - **AI correction field** ← Quote EXACTLY from SECTION E

⚠️ **Requirements are in XML format - parse them correctly:**
   ```xml
   <requirement function="function_name" type="requirement_type">
       Requirement text goes here
   </requirement>
   ```

⚠️ **NEVER copy text from SECTION D or E into the Requirement/Function/Type fields**

⚠️ **The Requirement/Function/Type come from SECTION B XML, corrections come from SECTION D/E**

---

# REQUIRED: COUNT SUMMARY

At the very end of your response, you MUST include the following structured count summary:

<AUXILIARY_METRIC_COUNT>
MATCH_COUNT: <number>
</AUXILIARY_METRIC_COUNT>

Where <number> is the total count of matched requirements you identified above. If there are no matches, use 0.

Example:
<AUXILIARY_METRIC_COUNT>
MATCH_COUNT: 5
</AUXILIARY_METRIC_COUNT>

END
